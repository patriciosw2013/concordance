<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Lectura</title>
    <style>
        .parrafo {
            text-align: left;
            padding: 10px !important;
            font: 12px "latoregular", "Trebuchet MS", Arial, Helvetica, sans-serif;
        }

        .task-lists {
            margin: 10px;
            padding: 10px;
            padding-top: 5px;
            font: 14px "latoregular", "Trebuchet MS", Arial, Helvetica, sans-serif;
            color: #282828;
            background-color: #FFFFFF;
            text-align: left;
        }

        .side-left {
            width: 30% !important;
        }

        .side-right {
            width: 70% !important;
        }

        .preformatted {
            white-space: pre-wrap;
            text-align: left;
            padding: 10px !important;
            font: 12px "latoregular", "Trebuchet MS", Arial, Helvetica, sans-serif;
            width: 400px;
        }

        .ui-scrollpanel-hbar {
            overflow-x: initial;
        }

        .right-aligned {
            display: flex;
            justify-content: flex-end;
            align-items: flex-start;
            gap: 10px;
            /* Espaciado entre el combobox y el bot√≥n */
        }
    </style>
</h:head>
<h:body>
    <h:form id="updateForm">
        <script>
            function copyTxt(copyText) {
                navigator.clipboard.writeText(copyText);
            }
        </script>
        <p:messages id="messages" showDetail="true" closable="true">
            <p:autoUpdate />
        </p:messages>
        <p:dialog id="modalNotes" header="Notas" widgetVar="dlg1" minHeight="300" width="500" showEffect="fade"
            closeOnEscape="true">
            <p:scrollPanel mode="native" id="pnlNotes" style="width: 450px; height: 300px;">
                <h:outputText value="#{readingController.notes}" styleClass="preformatted" escape="false" />
            </p:scrollPanel>
        </p:dialog>
        <div class="task-lists">
            <h:panelGrid columns="4"
                style="padding-left: 30px; padding-right: 30px; padding-bottom: 0px; width: 400px;">
                <p:selectOneMenu id="option" value="#{readingController.base}">
                    <f:selectItems var="o" value="#{readingController.bases}" itemLabel="#{o}" itemValue="#{o}" />
                    <p:ajax event="valueChange" listener="#{readingController.search}" update="bookTree" />
                </p:selectOneMenu>
            </h:panelGrid>
            <p:panelGrid columns="2" layout="grid" style="padding: 15px; padding-top: 0; width:100%;"
                columnClasses="side-left, side-right">
                <h:panelGroup />
                <h:panelGroup id="colTitle">
                    <h:panelGrid columns="2" width="100%">
                        <h:panelGroup>
                            <h:outputText id="txtTitle"
                                style="font-weight: bold; text-align:center; font-size: 14px; padding-right:20px; width: 100%;"
                                value="#{readingController.title}" />
                            <p:commandLink id="lnkCopyRef" value="" rendered="#{not empty readingController.title}"
                                onclick="copyTxt('#{readingController.title}');">
                                <i class="pi pi-clipboard" />
                            </p:commandLink>
                        </h:panelGroup>

                        <h:panelGroup styleClass="right-aligned">
                            <p:commandButton value="" icon="pi pi-file-pdf"
                                styleClass="rounded-button ui-button-secondary ui-button-outlined" rendered="false"
                                style="height:32px;width:32px;margin-left:10px;"
                                action="#{readingController.exportarPDF}" ajax="false" />

                            <p:commandButton value="" rendered="#{not empty readingController.notes}" type="button"
                                icon="pi pi-pen-to-square"
                                styleClass="rounded-button ui-button-secondary ui-button-outlined"
                                style="height:32px;width:32px;margin-left:10px;" onclick="PF('dlg1').show()" />

                            <p:selectOneMenu id="chapters" value="#{readingController.chapter}"
                                style="max-width: 400px;" rendered="#{not empty readingController.chapters}">
                                <f:selectItems var="o" value="#{readingController.chapters}" itemLabel="#{o.valor}"
                                    itemValue="#{o.codigo}" />
                                <p:ajax event="valueChange" listener="#{readingController.viewChapter}"
                                    update="pnl,modalNotes,colTitle" process="@this" />
                            </p:selectOneMenu>
                        </h:panelGroup>
                    </h:panelGrid>
                </h:panelGroup>

                <p:treeTable id="bookTree" value="#{readingController.books}" var="o" size="small"
                    selection="#{readingController.book}" selectionMode="single" scrollable="true" scrollHeight="510"
                    style="width: 100%; font-size: 14px;">
                    <p:ajax event="select" listener="#{readingController.onSelect}"
                        update="updateForm:pnl,updateForm:modalNotes,updateForm:colTitle" />
                    <p:column>
                        <h:outputText value="#{o.valor}" />
                    </p:column>
                </p:treeTable>

                <p:scrollPanel mode="native" id="pnl" style="width: 100%; height: 520px;">
                    <h:outputText value="#{readingController.txt}" styleClass="preformatted" escape="false" />
                </p:scrollPanel>
            </p:panelGrid>
        </div>
    </h:form>
</h:body>

</html>